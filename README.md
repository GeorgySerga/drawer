# A basic drawer app.

## Tech stack:
Frontend react app is generated by "create react app", additionaly "react-router-dom" and "material-ui" are added. Backend is "node.js" with "express". "Postgres" is used as a database. "Passport" and "express-sessions" are used for authentication. "pg" allows db seeding and communication. Canvas drawings are saved in base64.

## Possible improvements
- Move into docker containers.
- Add dotenv support for secrets, ports and other configs.
- Add tests.
- Add canvas drawing history. The localstorage is started with it in mind, dictionary saves canvas states with timestamps (see `save` dunction under `useCanvas`). On top of that `MAXIMUM_DRAWING_HISTORY_LENGTH` added and can be adjusted to preserve the whole history, or just limited steps. That is a limitation to not get memory overflows, but can be improved later on or omitted.
- Separate and more UX friendly register and login forms, existing ui is more of a shortcut.
- Request module for the frontend which would log user out if session is invalid (after the session expiration on the server and 401 http request, to use instead of the default fetch around the application).
- Custom Express middleware to check authentication (can use the same `isAuthenticated()` method already used in the app).
- The time of the first stroke, can be saved to lacalstorage as a separate value and then sent as a part of the upload payload or extracted from history.
- Complete deletion of the canvas and history when drawing (currently clear canvas button keeps history). Easy to implement as an existing canvas clear, plus `localstorage.removeItem()`.
- Creating the specific URL for private images (a random id can be sent back if private is true).
- Allow editing (personal) images (currently images stored as one value, but the same history from the localstorage can be sent to the db, so users could use timeline or use history, when editing later).

## A little bit about architecture
Frontend and Backend are located in the corresponding directories `/src/frontend` and `/src/backend`.

### Frontend

Frontend's basic structure is made by create react app. Not ejected. run `yarn start` (or `npm run start`) to start the application in dev mode (building is supported by create react app, but the static files aren't served by the express at the moment). The default port for the frontend is 3000. The entry point for the app is intact, it's `index.js` inside the `src`. `App.js` is the first meaningful component. `Authntication` status for the app is stored inside the react conext (see implementation inside the `src/providers`). The `canvas` is being returned by the hook. It's possible to put it into context as well, to reuse around the application easily, but it's not done because currently it's used only in one place (can be found inside `hooks` which would return the `canvas` and references to it and its `context`). Components are stored under the `components` directiry. Since the application is small on some closely related and larger parts are inside directiries (like `Canvas` with all the controls for it). `utils` have some canvas related utils in it (to scale to HiDPI screens, track touch and mouse event). The whole canvas related logic can be potentially be extracted into one place to form a library. To make this easier everything is extracted.

There are 3 screens.
- Login and register are united, using one form, to speed up the developement (I think they show the main idea).
- Drawing canvas is available only to logged in users. Currently the server related buttons are behind the autentication check as well. Removing authentication check for the route (`/draw`) it is easy to allow drawing and saving thing on canvas to local storage without the account, but not allowing uploads. Left as is, though allows a clean up if this feature is not required in the future.
- Main screen shows all public drawings (endpoint returns just the last 100) + private personal drawings if user is logged in. Personal images have a trash icon button on them, to allow deletion (same way it could be improved, to allow copy to canvas to allow editing, etc).

### Backend

To run use `node index.js` inside the `backend` directory or run `npm run dev:start` (it would run `nodemon`) and allow easier development. The default port for the backend is 3001.

`index.js` is an entry point. In order to run postgres should be running as well. `/db/init/index.js` seeds the databases with `users` table, `drawings` table and `session` table (the last one is used to store sessions. The can be stored in memory, it's just done to demonstrate the technique. The scripts to create `session` table are taken from the `connect-pg-simple` documentation at: https://www.npmjs.com/package/connect-pg-simple).

Postgres config used for connection:
```
{
  user: 'postgres',
  host: 'localhost',
  database: 'postgres',
  password: 'password',
  port: 5432,
}
```

`/db/pool/index.js` contains postgres client for the express application.

`/passport` contains passport configuration, to set up session authentication.

`/routes` contain logic for `users` and `drawings` endpoints.

## How to run
- Start postgres server (the app expects it to be running on the default port `5432` and have the default user `postgres`);
- Run seed file to create tables (should not exist before) `node src/backend/db/init/index.js`;
- Inside `/src/backend` run `node index.js`;
- Inside `/src/frontend` run `yarn start` (or `npm run start`)

## Demo
![Demo](demo.gif)